# TÃ“M Táº®T LOGIC TRANG HOME.TSX

## ğŸ¯ Má»¤C ÄÃCH
Trang chá»§ hiá»ƒn thá»‹ danh sÃ¡ch mÃ³n Äƒn/Ä‘á»“ uá»‘ng vá»›i kháº£ nÄƒng:
- Lá»c theo loáº¡i (táº¥t cáº£, Ä‘á»“ Äƒn, Ä‘á»“ uá»‘ng)
- Lá»c theo cá»­a hÃ ng (all, hoáº·c theo shopId cá»¥ thá»ƒ)
- TÃ¬m kiáº¿m theo tÃªn mÃ³n (bá» dáº¥u tiáº¿ng Viá»‡t)
- Hiá»ƒn thá»‹ tráº¡ng thÃ¡i "Háº¾T GIá»œ BÃN" hoáº·c "Háº¾T MÃ“N"
- Giá» hÃ ng ná»•i (floating cart button)

## ğŸ“Š STATE & DATA

**Store:**
- `foods`: danh sÃ¡ch mÃ³n Äƒn tá»« Firestore
- `users`: danh sÃ¡ch ngÆ°á»i dÃ¹ng (Ä‘á»ƒ láº¥y thÃ´ng tin shop)
- `system`: thÃ´ng tin há»‡ thá»‘ng
- `cart`: giá» hÃ ng hiá»‡n táº¡i

**Local State:**
- `currentHour`: giá» hiá»‡n táº¡i (Ä‘á»ƒ check háº¿t giá» bÃ¡n)
- `searchQuery`: tá»« khÃ³a tÃ¬m kiáº¿m
- `selectedType`: tab Ä‘ang chá»n (Táº¥t cáº£/Ä‘á»“ Äƒn/Ä‘á»“ uá»‘ng)
- `selectedShop`: shop Ä‘ang chá»n (all hoáº·c shopId)
- `showShopFilter`: hiá»‡n/áº©n dropdown chá»n shop

## ğŸ”„ LUá»’NG THá»°C THI

1. **Load dá»¯ liá»‡u:** Láº¥y `foods`, `users`, `cart` tá»« store
2. **TÃ­nh toÃ¡n cÃ¡c shop cÃ³ sáºµn:**
   - Láº¥y danh sÃ¡ch shopId duy nháº¥t tá»« foods
   - Join vá»›i users Ä‘á»ƒ láº¥y shopName, imgShopSquare
   - Sáº¯p xáº¿p theo sá»‘ mÃ³n giáº£m dáº§n
   - ThÃªm option "Táº¥t cáº£ cá»­a hÃ ng" vÃ o Ä‘áº§u
3. **Filter dá»¯ liá»‡u (memoized):**
   - Filter theo type: Ä‘á»“ Äƒn, Ä‘á»“ uá»‘ng, hoáº·c táº¥t cáº£
   - Filter theo searchQuery (bá» dáº¥u)
   - Filter theo selectedShop
   - TÃ­nh toÃ¡n `isOutOfTime` dá»±a vÃ o `timeStart`, `timeEnd`, `currentHour`
4. **Render danh sÃ¡ch:** FlatList vá»›i 2 cá»™t
5. **Nháº¥n mÃ³n:** Navigate Ä‘áº¿n `/ItemDetail` vá»›i params `item`

## ğŸ”§ CÃC FUNCTION QUAN TRá»ŒNG

### `removeVietnameseTones(str)`
Bá» dáº¥u tiáº¿ng Viá»‡t Ä‘á»ƒ so sÃ¡nh tÃ¬m kiáº¿m:
```js
str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/Ä‘/g, 'd').toLowerCase().trim()
```

### `formatCurrency(val)`
Chuyá»ƒn Ä‘á»•i sá»‘ sang Ä‘á»‹nh dáº¡ng VNÄ:
```js
(val * 1000).toLocaleString('vi-VN')
```

### Logic kiá»ƒm tra Háº¾T GIá»œ BÃN
```js
const start = Number(item.timeStart) || 0;
const end = Number(item.timeEnd) || 24;
let isExpired = false;

if (start < end) {
  // Khung giá» bÃ¬nh thÆ°á»ng: 7h-22h
  if (currentHour < start || currentHour >= end) isExpired = true;
} else if (start > end) {
  // Khung giá» qua Ä‘Ãªm: 22h-3h
  if (currentHour >= end && currentHour < start) isExpired = true;
}
```

## ğŸ¨ UI Cáº¤U TRÃšC

```
SafeAreaView
  â”œâ”€ View (Top Filter Row)
  â”‚   â”œâ”€ Shop Button (má»Ÿ dropdown)
  â”‚   â”œâ”€ Divider dá»c
  â”‚   â””â”€ ScrollView ngang (Tabs: Táº¥t cáº£, Ä‘á»“ Äƒn, Ä‘á»“ uá»‘ng)
  â”‚
  â”œâ”€ Shop Dropdown (khi showShopFilter = true)
  â”‚   â””â”€ ScrollView ngang (danh sÃ¡ch shop)
  â”‚
  â”œâ”€ FlatList (2 cá»™t)
  â”‚   â”œâ”€ Header: "X sáº£n pháº©m táº¡i Shop Y"
  â”‚   â””â”€ renderFoodItem: Card mÃ³n Äƒn
  â”‚       â”œâ”€ Image (cÃ³ badge shop náº¿u all, overlay Háº¾T MÃ“N/Háº¾T GIá»œ)
  â”‚       â”œâ”€ Name
  â”‚       â””â”€ Price (giÃ¡ KM + giÃ¡ gá»‘c gáº¡ch ngang)
  â”‚
  â””â”€ Floating Bottom Search Bar
      â”œâ”€ TextInput tÃ¬m kiáº¿m
      â””â”€ Cart Button (badge sá»‘ lÆ°á»£ng)
```

## âš¡ ÄIá»‚M Äáº¶C BIá»†T

1. **Filter káº¿t há»£p 3 chiá»u:** Type + Search + Shop
2. **Shop Badge:** Chá»‰ hiá»‡n khi `selectedShop === 'all'` Ä‘á»ƒ biáº¿t mÃ³n thuá»™c shop nÃ o
3. **Overlay Háº¾T MÃ“N/Háº¾T GIá»œ:**
   - `effectiveStatus === 'disable'` â†’ "Háº¾T MÃ“N"
   - `isOutOfTime === true` â†’ "Háº¾T GIá»œ BÃN"
   - MÃ³n bá»‹ disable khÃ´ng thá»ƒ nháº¥n vÃ o
4. **Compact Filter UI:** Shop button + Tabs trÃªn cÃ¹ng má»™t hÃ ng ngang
5. **Floating Search Bar:** Thanh tÃ¬m kiáº¿m dÆ°á»›i cÃ¹ng vá»›i nÃºt giá» hÃ ng
6. **Real-time giá»:** DÃ¹ng `useFocusEffect` Ä‘á»ƒ update `currentHour` má»—i láº§n vÃ o trang
7. **Optimization:** DÃ¹ng `useMemo` cho availableShops, filteredData, selectedShopInfo Ä‘á»ƒ trÃ¡nh tÃ­nh toÃ¡n láº¡i khÃ´ng cáº§n thiáº¿t

## ğŸš€ USER JOURNEY

**KhÃ¡ch vÃ£ng lai / User thÆ°á»ng:**
1. Má»Ÿ app â†’ Home screen (tab máº·c Ä‘á»‹nh)
2. Xem danh sÃ¡ch mÃ³n Äƒn
3. Chá»n filter: Tabs (Ä‘á»“ Äƒn/Ä‘á»“ uá»‘ng), Shop, Search
4. Nháº¥n mÃ³n â†’ ItemDetail
5. Nháº¥n giá» hÃ ng â†’ Cart

**Shop Owner:**
(TÆ°Æ¡ng tá»± user thÆ°á»ng, xem Ä‘Æ°á»£c mÃ³n cá»§a táº¥t cáº£ shop)

**Admin:**
(TÆ°Æ¡ng tá»± user thÆ°á»ng, cÃ³ thá»ƒ vÃ o admin tab riÃªng)

**Shipper:**
(TÆ°Æ¡ng tá»± user thÆ°á»ng, cÃ³ shipper tab riÃªng)

## ğŸ”— NAVIGATION

**Navigates TO:**
- `/ItemDetail` (nháº¥n vÃ o card mÃ³n)
- `/cart` (nháº¥n nÃºt giá» hÃ ng)

**Navigates FROM:**
- N/A (Ä‘Ã¢y lÃ  tab máº·c Ä‘á»‹nh khi má»Ÿ app)

## ğŸ’¡ LÆ¯U Ã Ká»¸ THUáº¬T

1. **Type Ä‘á»“ uá»‘ng cÃ³ 2 giÃ¡ trá»‹:** `type === 'Ä‘á»“ uá»‘ng'` hoáº·c `type === '2'`
2. **Filter tabs hardcode:** `['Táº¥t cáº£', 'Ä‘á»“ Äƒn', 'Ä‘á»“ uá»‘ng']`
3. **useFocusEffect:** Cáº­p nháº­t `currentHour` má»—i láº§n focus vÃ o tab home
4. **totalItemsInCart:** TÃ­nh tá»•ng `quantity` cá»§a táº¥t cáº£ item trong cart
5. **Card opacity 0.5:** Khi mÃ³n disable (háº¿t giá» hoáº·c háº¿t mÃ³n)
6. **Alert khÃ¡c nhau Web vs Native:**
   - Web: `window.alert(msg)`
   - Native: `Alert.alert("ThÃ´ng bÃ¡o", msg)`
7. **ShopInfo type:** `{id, name, img?, productCount?}`
8. **FoodItem type:** `{id, name, type, shopId?, img?, pricePromo, priceNormal, effectiveStatus?, timeStart?, timeEnd?}`
9. **Vertical Divider:** NgÄƒn cÃ¡ch giá»¯a shop button vÃ  tabs
10. **Border color cá»§a card:** KhÃ´ng cÃ³ mÃ u Ä‘áº·c biá»‡t, dÃ¹ng elevation/shadow
