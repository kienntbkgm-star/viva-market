# TÃ“M Táº®T LOGIC TRANG INDEX.TSX

## ğŸ¯ Má»¤C ÄÃCH CHÃNH
Trang **entry point** cá»§a app, vá»«a lÃ  **splash screen** vá»«a lÃ  **debug tool** Ä‘á»ƒ xem vÃ  backup dá»¯ liá»‡u.

## ğŸ“Š Dá»® LIá»†U QUáº¢N LÃ

**11 Collections tá»« Firestore:**
- system, promos, itemType, foods, goods, services, users
- foodOrders, goodOrders, serviceOrders, transactions

**State local:**
- `selectedCollection`: Collection Ä‘ang xem (máº·c Ä‘á»‹nh 'system')
- `isBackingUp`: Tráº¡ng thÃ¡i Ä‘ang backup
- `copySuccess` / `copyFullSuccess`: ThÃ´ng bÃ¡o copy thÃ nh cÃ´ng

## ğŸ”„ LUá»’NG THá»°C THI

### 1ï¸âƒ£ **Khi App Khá»Ÿi Äá»™ng**
```
Component Mount 
  â†“
Store tá»± Ä‘á»™ng load 11 collections tá»« Firestore (realtime listener)
  â†“
Hiá»ƒn thá»‹ loading: "Äang náº¡p 11 collection tá»« Firestore..."
  â†“
isLoading = false khi load xong
```

### 2ï¸âƒ£ **Auto Backup (useEffect)**
```javascript
useEffect(() => {
  if (!isLoading && system && foods.length > 0) {
    handleFullBackup();  // Tá»± Ä‘á»™ng backup ngáº§m
  }
}, [isLoading, system, foods]);
```

**Äiá»u kiá»‡n trigger:**
- âœ… KhÃ´ng cÃ²n loading
- âœ… System cÃ³ data
- âœ… Foods cÃ³ Ã­t nháº¥t 1 mÃ³n

**HÃ nh Ä‘á»™ng:**
- PUT request lÃªn JSONBin.io vá»›i 11 collections
- **Cháº¡y ngáº§m, khÃ´ng thÃ´ng bÃ¡o** cho user
- Chá»‰ log console

### 3ï¸âƒ£ **Hiá»ƒn thá»‹ Debug UI**
Load xong â†’ Hiá»ƒn thá»‹:
- **11 nÃºt collection** (horizontal scroll) - má»—i nÃºt cÃ³ icon, tÃªn, sá»‘ lÆ°á»£ng
- **JSON viewer** - Xem data cá»§a collection Ä‘ang chá»n
- **2 nÃºt copy**: Copy 1 collection / Copy full DB
- **2 nÃºt action**: "BACKUP NOW" / "CONTINUE TO APP"

## ğŸ”§ CÃC FUNCTION QUAN TRá»ŒNG

### `handleNavigateToApp()`
**Äiá»u hÆ°á»›ng khi nháº¥n "CONTINUE TO APP":**
```
1. Gá»i restoreSession() - kiá»ƒm tra AsyncStorage
2. Náº¿u cÃ³ session â†’ router.replace('/(tabs)/home')
3. Náº¿u khÃ´ng â†’ router.replace('/login')
```

### `handleFullBackup()`
**Backup 11 collections lÃªn JSONBin.io:**
- Method: PUT
- URL: `https://api.jsonbin.io/v3/b/{BIN_ID}`
- Headers: X-Master-Key, Content-Type
- Body: JSON object chá»©a 11 collections
- **KhÃ´ng alert, chá»‰ log console**

### `handleCopyToClipboard()` / `handleCopyFullDatabase()`
**Copy JSON vÃ o clipboard:**
- Kiá»ƒm tra Platform.OS:
  - Web: `navigator.clipboard.writeText()`
  - Mobile: `Clipboard.setString()`
- Hiá»ƒn thá»‹ "âœ… Copied!" trong 3 giÃ¢y

### `getCollectionCount()`
**Äáº¿m sá»‘ item trong collection:**
- Array â†’ return `length`
- Object â†’ return `Object.keys().length`
- Else â†’ return `0`

## ğŸ¨ UI LOGIC

### **Khi isLoading = true:**
- Hiá»ƒn thá»‹ ActivityIndicator
- Text: "Äang náº¡p 11 collection tá»« Firestore..."

### **Khi isLoading = false:**
1. Collection selector (11 nÃºt vá»›i badge sá»‘ lÆ°á»£ng)
2. Collection header (tÃªn + 2 nÃºt copy)
3. Copy success message (náº¿u cÃ³, auto hide sau 3s)
4. JSON viewer (cÃ³ thá»ƒ scroll vÃ  select text)
5. Footer vá»›i 2 nÃºt action

## âš™ï¸ ÄIá»‚M Äáº¶C BIá»†T

âœ… **KhÃ´ng redirect tá»± Ä‘á»™ng** - User pháº£i nháº¥n "CONTINUE TO APP"
âœ… **Auto backup ngáº§m** - Má»—i láº§n load xong data
âœ… **Realtime sync** - Data tá»« store tá»± Ä‘á»™ng update tá»« Firestore
âœ… **Debug tool** - Dev cÃ³ thá»ƒ xem, copy, backup data báº¥t cá»© lÃºc nÃ o
âœ… **Session check** - Äiá»u hÆ°á»›ng thÃ´ng minh dá»±a vÃ o tráº¡ng thÃ¡i login

## ğŸš€ USER JOURNEY

```
Má»Ÿ app
  â†“
Loading... (load 11 collections)
  â†“
[Auto backup ngáº§m cháº¡y]
  â†“
Hiá»ƒn thá»‹ debug UI
  â†“
User nháº¥n "CONTINUE TO APP"
  â†“
Check session â†’ Home hoáº·c Login
```

===============================================================================
Cáº¬P NHáº¬T: 27/01/2026
===============================================================================
