# TÃ“M Táº®T LOGIC TRANG ITEMDETAIL.TSX

## ğŸ¯ Má»¤C ÄÃCH
Trang **chi tiáº¿t mÃ³n Äƒn** - hiá»ƒn thá»‹ thÃ´ng tin mÃ³n, cho phÃ©p chá»n options (size, topping), thÃªm vÃ o giá» hÃ ng

## ğŸ“Š STATE & DATA

**Props tá»« params:**
- `item`: JSON string cá»§a mÃ³n Äƒn (parse thÃ nh object)

**State local:**
- `quantity`: Sá»‘ lÆ°á»£ng (máº·c Ä‘á»‹nh 1)
- `note`: Ghi chÃº cho mÃ³n
- `selectedOptions`: Máº£ng index cÃ¡c option Ä‘Ã£ chá»n

**Data tá»« Store:**
- `users`: Danh sÃ¡ch user (Ä‘á»ƒ tÃ¬m shop owner)
- `addToCart()`: Function thÃªm vÃ o giá» hÃ ng

## ğŸ¨ LOGIC Xá»¬ LÃ OPTIONS

### **1. PhÃ¢n loáº¡i Options:**
```javascript
activeOptions = item.option.filter(opt => 
  opt.status === true || 'true' || 'enable'
)

sizeOptions = options cÃ³ tÃªn chá»©a 'size' hoáº·c s/m/l/xl/xxl
otherOptions = cÃ¡c options cÃ²n láº¡i (topping, extra...)
```

### **2. Logic Chá»n Size:**
```
- Chá»‰ Ä‘Æ°á»£c chá»n 1 size duy nháº¥t
- Náº¿u chá»n size má»›i â†’ Bá» size cÅ© tá»± Ä‘á»™ng
- Size cÃ³ thá»© tá»±: s < m < l < xl < xxl
- Khi thÃªm vÃ o giá» â†’ Chá»‰ láº¥y size Lá»šN NHáº¤T (náº¿u chá»n nhiá»u)
```

### **3. Logic Chá»n Other Options:**
```
- ÄÆ°á»£c chá»n nhiá»u (checkbox)
- KhÃ´ng giá»›i háº¡n sá»‘ lÆ°á»£ng
- CÃ³ thá»ƒ bá» chá»n báº¥t ká»³
```

### **4. Default Options:**
```javascript
// Khi component mount, tá»± Ä‘á»™ng chá»n options cÃ³ isDefault = true

Size default:
  - Náº¿u cÃ³ nhiá»u size default â†’ Chá»n size Lá»šN NHáº¤T
  - VD: S & M Ä‘á»u default â†’ Chá»n M

Other default:
  - Chá»n Táº¤T Cáº¢ options cÃ³ isDefault = true
```

## ğŸ”„ LUá»’NG THá»°C THI

### **1. Load Trang:**
```
Parse item tá»« params
  â†“
Lá»c activeOptions (status = enable)
  â†“
PhÃ¢n loáº¡i: sizeOptions vs otherOptions
  â†“
Auto-select default options (size lá»›n nháº¥t + all other defaults)
  â†“
TÃ­nh extraPrice tá»« options Ä‘Ã£ chá»n
  â†“
Render UI
```

### **2. ThÃªm VÃ o Giá» HÃ ng:**
```
User nháº¥n "THÃŠM VÃ€O GIá» HÃ€NG"
  â†“
handleAddToCart() Ä‘Æ°á»£c gá»i
  â†“
Kiá»ƒm tra isDisabled:
  - effectiveStatus === 'disable' â†’ Táº¡m ngÆ°ng
  - isOutOfTime â†’ Háº¿t giá» bÃ¡n
  â†“
Lá»c selectedOptions:
  - Vá»›i size: Chá»‰ láº¥y size Lá»šN NHáº¤T
  - Vá»›i other: Láº¥y táº¥t cáº£
  â†“
Gá»i addToCart(item + selectedOptions + extraPrice, quantity, note)
  â†“
Alert "ÄÃ£ thÃªm vÃ o giá» hÃ ng"
  â†“
router.back()
```

## ğŸ”§ CÃC FUNCTION QUAN TRá»ŒNG

### `getLargestSize(selectedSizeIndexes)`
**Má»¥c Ä‘Ã­ch:** TÃ¬m size lá»›n nháº¥t trong danh sÃ¡ch Ä‘Ã£ chá»n

**Logic:**
```javascript
1. Loop qua selectedSizeIndexes
2. Láº¥y order tá»« sizeOrder dictionary:
   { 's': 1, 'm': 2, 'l': 3, 'xl': 4, 'xxl': 5 }
3. So sÃ¡nh order, giá»¯ size cÃ³ order cao nháº¥t
4. Return index cá»§a size lá»›n nháº¥t
```

### `handleToggleOption(optionIndex, isSizeOption)`
**Má»¥c Ä‘Ã­ch:** Xá»­ lÃ½ khi user click chá»n/bá» chá»n option

**Logic cho Size:**
```javascript
if (Ä‘ang chá»n size nÃ y) {
  Bá» chá»n â†’ XÃ³a táº¥t cáº£ size khá»i selectedOptions
} else {
  Chá»n size má»›i â†’ XÃ³a size cÅ© + ThÃªm size má»›i
}
```

**Logic cho Other Options:**
```javascript
if (Ä‘ang chá»n) {
  Bá» chá»n â†’ Remove khá»i array
} else {
  Chá»n â†’ Add vÃ o array
}
```

### `handleAddToCart()`
**Validation:**
```javascript
if (isDisabled) {
  Alert thÃ´ng bÃ¡o mÃ³n táº¡m ngÆ°ng hoáº·c háº¿t giá» bÃ¡n
  return;
}
```

**Xá»­ lÃ½:**
```javascript
1. Lá»c selectedOptions:
   - TÃ¬m size lá»›n nháº¥t
   - Giá»¯ size lá»›n nháº¥t + all other options
2. Map indexes â†’ option objects
3. addToCart({
     ...item,
     selectedOptions: selectedOptionObjects,
     extraPrice: extraPrice
   }, quantity, note)
4. Alert thÃ nh cÃ´ng
5. router.back()
```

## ğŸ’° TÃNH GIÃ

### **Extra Price (GiÃ¡ options):**
```javascript
extraPrice = selectedOptions
  .map(index => find option by index)
  .reduce((sum, opt) => sum + (opt.price * 1000), 0)
```

### **Total Price:**
```javascript
totalPrice = ((item.pricePromo * 1000) + extraPrice) * quantity
```

**VÃ­ dá»¥:**
- MÃ³n: 50k (pricePromo)
- Size M: +10k
- Topping phÃ´ mai: +5k
- Quantity: 2
- Total = ((50 + 10 + 5) * 2) = 130k

## ğŸš« DISABLE LOGIC

**MÃ³n bá»‹ disable khi:**
```javascript
isDisabled = effectiveStatus === 'disable' || isOutOfTime

effectiveStatus:
  - 'enable' â†’ BÃ¬nh thÆ°á»ng
  - 'disable' â†’ Shop táº¯t táº¡m thá»i

isOutOfTime:
  - Giá» hiá»‡n táº¡i NGOÃ€I khoáº£ng [timeStart, timeEnd]
  - VD: MÃ³n chá»‰ bÃ¡n 7h-11h, giá» 14h â†’ isOutOfTime = true
```

**Khi disable:**
- NÃºt "THÃŠM VÃ€O GIá» HÃ€NG" Ä‘á»•i thÃ nh:
  - "Háº¾T GIá»œ BÃN" (náº¿u isOutOfTime)
  - "Táº M NGÆ¯NG" (náº¿u disable)
- Click nÃºt â†’ Alert thÃ´ng bÃ¡o lÃ½ do

## ğŸ¨ UI Cáº¤U TRÃšC

```
SafeAreaView
  â†“
ScrollView
  â”œâ”€â”€ NÃºt back (arrow)
  â”œâ”€â”€ Image banner (mÃ³n Äƒn)
  â”œâ”€â”€ Shop info (icon + tÃªn shop + Ä‘á»‹a chá»‰)
  â”œâ”€â”€ TÃªn mÃ³n
  â”œâ”€â”€ GiÃ¡ (pricePromo, priceNormal gáº¡ch)
  â”œâ”€â”€ MÃ´ táº£
  â”œâ”€â”€ Section: KÃ­ch thÆ°á»›c (Size options - radio)
  â”œâ”€â”€ Section: Lá»±a chá»n thÃªm (Other options - checkbox)
  â”œâ”€â”€ Section: Ghi chÃº (TextInput)
  â””â”€â”€ Footer:
      â”œâ”€â”€ Quantity controls (-/+)
      â””â”€â”€ NÃºt "THÃŠM VÃ€O GIá» HÃ€NG" + Tá»•ng tiá»n
```

## âš¡ ÄIá»‚M Äáº¶C BIá»†T

âœ… **Size logic thÃ´ng minh** - Chá»‰ giá»¯ size lá»›n nháº¥t khi thÃªm vÃ o giá»
âœ… **Auto-select defaults** - Tá»± Ä‘á»™ng chá»n options cÃ³ isDefault = true
âœ… **PhÃ¢n loáº¡i options** - Size vs Other options, UI khÃ¡c nhau
âœ… **Real-time price** - Tá»•ng tiá»n cáº­p nháº­t ngay khi thay Ä‘á»•i options/quantity
âœ… **Time-based availability** - MÃ³n chá»‰ bÃ¡n trong giá» cá»¥ thá»ƒ
âœ… **Shop owner info** - Hiá»ƒn thá»‹ tÃªn shop, Ä‘á»‹a chá»‰ tá»« users array

## ğŸš€ USER JOURNEY

```
User xem danh sÃ¡ch mÃ³n â†’ Click mÃ³n
  â†“
VÃ o ItemDetail
  â†“
Xem thÃ´ng tin: tÃªn, giÃ¡, mÃ´ táº£, shop
  â†“
Chá»n size (1 option)
  â†“
Chá»n topping (nhiá»u options)
  â†“
Nháº­p ghi chÃº (optional)
  â†“
Äiá»u chá»‰nh sá»‘ lÆ°á»£ng
  â†“
Xem tá»•ng tiá»n real-time
  â†“
Nháº¥n "THÃŠM VÃ€O GIá» HÃ€NG"
  â†“
Alert thÃ nh cÃ´ng â†’ Quay vá» trang trÆ°á»›c
```

## ğŸ’¡ LÆ¯U Ã Ká»¸ THUáº¬T

**Size Order Dictionary:**
```javascript
sizeOrder = {
  's': 1, 'size s': 1, 'small': 1,
  'm': 2, 'size m': 2, 'medium': 2,
  'l': 3, 'size l': 3, 'large': 3,
  'xl': 4, 'size xl': 4, 'x-large': 4,
  'xxl': 5, 'size xxl': 5, 'xx-large': 5
}
```
- Há»— trá»£ nhiá»u format tÃªn size
- Case-insensitive (toLowerCase trÆ°á»›c khi check)

**Option Structure:**
```javascript
{
  name: "Size M",
  index: 0,
  price: 10,          // GiÃ¡ thÃªm (nghÃ¬n Ä‘á»“ng)
  status: true,       // enable/disable
  isDefault: false    // Auto-select hay khÃ´ng
}
```

**AddToCart Payload:**
```javascript
{
  ...item,                    // Spread táº¥t cáº£ thÃ´ng tin mÃ³n
  selectedOptions: [...],     // Máº£ng option objects
  extraPrice: 15000,          // Tá»•ng giÃ¡ options
  quantity: 2,                // Sá»‘ lÆ°á»£ng
  note: "KhÃ´ng hÃ nh"          // Ghi chÃº
}
```

===============================================================================
Cáº¬P NHáº¬T: 27/01/2026
===============================================================================
