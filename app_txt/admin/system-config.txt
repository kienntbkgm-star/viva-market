# TÃ“M Táº®T LOGIC TRANG ADMIN/SYSTEM-CONFIG.TSX

## ğŸ¯ Má»¤C ÄÃCH
Trang cáº¥u hÃ¬nh toÃ n bá»™ tham sá»‘ há»‡ thá»‘ng:
- ThÃ´ng tin chung (Admin phone, promo enable, freeship code)
- TÃ i chÃ­nh & Tá»· lá»‡ chia sáº» (admin/shipper/manager ratio)
- Váº­n chuyá»ƒn (phÃ­ ship, cho phÃ©p chá»n shipper)
- Timeout (thá»i gian chá» Ä‘Æ¡n hÃ ng)
- Giá»›i háº¡n shop (max shop per order)
- HÃ¬nh áº£nh chÃ o má»«ng (welcome images)

## ğŸ“Š STATE & DATA

**Store:**
- `system`: Object chá»©a táº¥t cáº£ config tá»« Firestore `system/config`

**Local State (formData):**
```js
{
  adminPhone: string,
  money: {
    adminShipRatio: string,
    managerGoodFee: string,
    managerShipRatio: string,
    refusePunish: string,
    shipperShipRatio: string
  },
  ship: {
    food: {
      atDoorValue: string,
      normalValue: string,
      step: string
    },
    selectEnable: boolean
  },
  timeOut: {
    finish: string,
    food: string,
    good: string,
    service: string
  },
  maxShop: {
    food: string,
    good: string
  },
  promo: {
    enable: boolean,
    freeShipCode: string
  },
  welcomeImage: array
}
```

## ğŸ”„ LUá»’NG THá»°C THI

### Load Config
1. Load `system` tá»« store
2. Map táº¥t cáº£ fields vÃ o `formData` state
3. Convert Number â†’ String cho TextInput
4. Hiá»ƒn thá»‹ trong form

### Edit Config
1. User sá»­a TextInput hoáº·c Toggle Switch
2. Update `formData` state
3. KhÃ´ng save ngay (chá» nháº¥n nÃºt LÆ°u)

### Save Config
1. Nháº¥n nÃºt "LÆ°u" (header)
2. Convert String â†’ Number cho cÃ¡c field cáº§n thiáº¿t
3. Build payload object
4. Update Firestore `system/config`
5. ThÃªm `logDate` timestamp
6. Alert thÃ nh cÃ´ng

## ğŸ”§ CÃC FUNCTION QUAN TRá»ŒNG

### `handleSave()`
```js
const handleSave = async () => {
  try {
    const systemRef = doc(db, 'system', 'config');
    
    const payload = {
      ...formData,
      money: {
        adminShipRatio: Number(formData.money.adminShipRatio),
        managerGoodFee: Number(formData.money.managerGoodFee),
        managerShipRatio: Number(formData.money.managerShipRatio),
        refusePunish: Number(formData.money.refusePunish),
        shipperShipRatio: Number(formData.money.shipperShipRatio),
      },
      ship: {
        ...formData.ship,
        food: {
          atDoorValue: Number(formData.ship.food.atDoorValue),
          normalValue: Number(formData.ship.food.normalValue),
          step: Number(formData.ship.food.step),
        }
      },
      timeOut: {
        finish: Number(formData.timeOut.finish),
        food: Number(formData.timeOut.food),
        good: Number(formData.timeOut.good),
        service: Number(formData.timeOut.service),
      },
      maxShop: {
        food: Number(formData.maxShop.food),
        good: Number(formData.maxShop.good)
      },
      logDate: new Date().toLocaleString('en-US'),
    };

    await updateDoc(systemRef, payload);
    Alert.alert("ThÃ nh cÃ´ng", "Cáº¥u hÃ¬nh há»‡ thá»‘ng Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t");
  } catch (error) {
    Alert.alert("Lá»—i", error.message);
  }
};
```

### `updateWelcomeImage(index, value)`
```js
const updateWelcomeImage = (index, value) => {
  const newImages = [...formData.welcomeImage];
  newImages[index] = value;
  setFormData({ ...formData, welcomeImage: newImages });
};
```

## ğŸ¨ UI Cáº¤U TRÃšC

```
SafeAreaView
  â”œâ”€ KeyboardAvoidingView (iOS padding)
  â”‚   â”œâ”€ Header
  â”‚   â”‚   â”œâ”€ Close Button
  â”‚   â”‚   â”œâ”€ Title: "Cáº¥u hÃ¬nh há»‡ thá»‘ng"
  â”‚   â”‚   â””â”€ Save Button (primary)
  â”‚   â”‚
  â”‚   â””â”€ ScrollView (padding: 15)
  â”‚       â”œâ”€ Section: THÃ”NG TIN CHUNG
  â”‚       â”‚   â”œâ”€ Admin Phone
  â”‚       â”‚   â”œâ”€ Switch: Báº­t mÃ£ giáº£m giÃ¡
  â”‚       â”‚   â””â”€ FreeShip Code
  â”‚       â”‚
  â”‚       â”œâ”€ Section: TÃ€I CHÃNH & Tá»¶ Lá»† CHIA Sáºº
  â”‚       â”‚   â”œâ”€ Row: Admin hÆ°á»Ÿng + Shipper hÆ°á»Ÿng
  â”‚       â”‚   â””â”€ Row: Manager hÆ°á»Ÿng + PhÃ­ quáº£n lÃ½ hÃ ng
  â”‚       â”‚
  â”‚       â”œâ”€ Section: Váº¬N CHUYá»‚N & GIá»šI Háº N
  â”‚       â”‚   â”œâ”€ Switch: Cho phÃ©p chá»n Shipper
  â”‚       â”‚   â””â”€ Row: Ship thÆ°á»ng + Táº­n cá»­a
  â”‚       â”‚
  â”‚       â”œâ”€ Section: THá»œI GIAN CHá»œ (TIMEOUT)
  â”‚       â”‚   â”œâ”€ Row: Äá»“ Äƒn + Dá»‹ch vá»¥ (seconds)
  â”‚       â”‚   â””â”€ Tá»± Ä‘á»™ng hoÃ n thÃ nh (seconds)
  â”‚       â”‚
  â”‚       â”œâ”€ Section: HÃŒNH áº¢NH CHÃ€O Má»ªNG
  â”‚       â”‚   â””â”€ TextInput for each image URL
  â”‚       â”‚
  â”‚       â””â”€ Log Text: "Cáº­p nháº­t láº§n cuá»‘i: ..."
```

## âš¡ ÄIá»‚M Äáº¶C BIá»†T

1. **Nested State:** formData cÃ³ cáº¥u trÃºc lá»“ng sÃ¢u 3 cáº¥p
2. **String â†” Number:** TextInput dÃ¹ng string, Firestore lÆ°u number
3. **Switch Fields:** 
   - `promo.enable`: Báº­t/táº¯t promo
   - `ship.selectEnable`: Cho phÃ©p chá»n shipper
4. **Ratio Fields:** % chia sáº» (0-100)
5. **Ship Fees:** ÄÆ¡n vá»‹ nghÃ¬n Ä‘á»“ng (k)
6. **Timeout:** ÄÆ¡n vá»‹ giÃ¢y (seconds)
7. **welcomeImage:** Array of URL strings
8. **logDate:** Timestamp cáº­p nháº­t cuá»‘i (format: 'en-US')
9. **KeyboardAvoidingView:** iOS cáº§n padding Ä‘á»ƒ khÃ´ng che input
10. **ScrollView:** DÃ i, cáº§n scroll Ä‘á»ƒ tháº¥y háº¿t
11. **Section Style:** Background white, elevation 1, margin 15
12. **Row Layout:** flexDirection row, justifyContent space-between
13. **Col Width:** 48% má»—i cá»™t trong row
14. **Input Style:** Background #f5f7f9, border #eef1f4
15. **Save Button:** Background primary, padding 20x8

## ğŸš€ USER JOURNEY

**Admin:**
1. VÃ o System Config tá»« dashboard
2. Xem táº¥t cáº£ cáº¥u hÃ¬nh hiá»‡n táº¡i
3. Sá»­a cÃ¡c field cáº§n thiáº¿t:
   - Admin phone
   - Tá»· lá»‡ chia sáº» tiá»n ship
   - PhÃ­ ship (thÆ°á»ng/táº­n cá»­a)
   - Timeout Ä‘Æ¡n hÃ ng
   - Welcome images
4. Nháº¥n "LÆ°u"
5. Alert thÃ nh cÃ´ng â†’ Config Ä‘Æ°á»£c apply toÃ n há»‡ thá»‘ng

## ğŸ”— NAVIGATION

**Navigates TO:**
- (None - chá»‰ close/back)

**Navigates FROM:**
- Admin dashboard menu "CÃ i Ä‘áº·t"

## ğŸ’¡ LÆ¯U Ã Ká»¸ THUáº¬T

1. **Firestore Path:** `system/config` (single document)
2. **Default Values:** Fallback vá» 0 hoáº·c string rá»—ng náº¿u thiáº¿u
3. **Ratio Sum:** adminShipRatio + shipperShipRatio nÃªn = 100%
4. **Step Field:** PhÃ­ thÃªm quÃ¡n (má»—i shop thÃªm +X k)
5. **refusePunish:** PhÃ­ pháº¡t khi shipper tá»« chá»‘i Ä‘Æ¡n
6. **managerGoodFee:** PhÃ­ quáº£n lÃ½ hÃ ng hÃ³a
7. **finish Timeout:** Tá»± Ä‘á»™ng chuyá»ƒn completed sau X giÃ¢y
8. **maxShop:** Giá»›i háº¡n sá»‘ shop tá»‘i Ä‘a trong 1 Ä‘Æ¡n
9. **welcomeImage Length:** Map qua array Ä‘á»ƒ render tá»«ng input
10. **logDate Format:** `new Date().toLocaleString('en-US')`
11. **Update Mode:** `updateDoc()` (khÃ´ng dÃ¹ng set/merge)
12. **Number() Conversion:**
    ```js
    Number(formData.money.adminShipRatio)
    ```
    Chuyá»ƒn string â†’ number trÆ°á»›c khi lÆ°u
13. **Nested Update:** Spread operator Ä‘á»ƒ update nested object
14. **Close Button:** Icon "close" thay vÃ¬ "chevron-back"
15. **Label Font Size:** 11px (nhá», tiáº¿t kiá»‡m khÃ´ng gian)

## ğŸ” CONFIG FIELDS DETAIL

### money Object
- `adminShipRatio`: % admin nháº­n tá»« phÃ­ ship (VD: 30%)
- `shipperShipRatio`: % shipper nháº­n tá»« phÃ­ ship (VD: 70%)
- `managerShipRatio`: % manager nháº­n (náº¿u cÃ³)
- `managerGoodFee`: PhÃ­ quáº£n lÃ½ hÃ ng hÃ³a
- `refusePunish`: Pháº¡t shipper tá»« chá»‘i Ä‘Æ¡n

### ship Object
- `food.normalValue`: PhÃ­ ship thÆ°á»ng (k)
- `food.atDoorValue`: PhÃ­ ship táº­n cá»­a (k)
- `food.step`: PhÃ­ thÃªm quÃ¡n (k)
- `selectEnable`: Cho phÃ©p user chá»n shipper

### timeOut Object
- `food`: Timeout Ä‘Æ¡n Ä‘á»“ Äƒn (seconds)
- `good`: Timeout Ä‘Æ¡n hÃ ng hÃ³a (seconds)
- `service`: Timeout Ä‘Æ¡n dá»‹ch vá»¥ (seconds)
- `finish`: Tá»± Ä‘á»™ng completed (seconds)

### maxShop Object
- `food`: Max sá»‘ shop trong 1 Ä‘Æ¡n food
- `good`: Max sá»‘ shop trong 1 Ä‘Æ¡n good

### promo Object
- `enable`: Báº­t/táº¯t promo toÃ n há»‡ thá»‘ng
- `freeShipCode`: MÃ£ freeship máº·c Ä‘á»‹nh

### Others
- `adminPhone`: SÄT admin support
- `welcomeImage`: Array URL áº£nh welcome screen
- `logDate`: Timestamp cáº­p nháº­t cuá»‘i
