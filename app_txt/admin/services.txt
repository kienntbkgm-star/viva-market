# TÃ“M Táº®T LOGIC TRANG ADMIN/SERVICES.TSX

## ğŸ¯ Má»¤C ÄÃCH
Quáº£n lÃ½ danh sÃ¡ch dá»‹ch vá»¥ sá»­a chá»¯a & dá»n dáº¹p:
- Hiá»ƒn thá»‹ táº¥t cáº£ services tá»« Firestore
- Báº­t/táº¯t tráº¡ng thÃ¡i dá»‹ch vá»¥ (enable/disable)
- **XUáº¤T Excel** (Export) - Header chuáº©n DB
- **NHáº¬P Excel** (Import) - Header chuáº©n DB
- Navigate Ä‘áº¿n edit-service Ä‘á»ƒ chá»‰nh sá»­a chi tiáº¿t

## ğŸ“Š STATE & DATA

**Store:**
- `services`: Danh sÃ¡ch dá»‹ch vá»¥ tá»« collection `services`

**Local State:**
- `isProcessing`: Tráº¡ng thÃ¡i Ä‘ang xá»­ lÃ½ import/export

**Excel Structure (Header chuáº©n DB):**
```
id, name, priceNormal, pricePromo, moneyShare, image, status, index, shopId, note
```

## ğŸ”„ LUá»’NG THá»°C THI

### Display Flow
1. Load `services` tá»« store
2. Hiá»ƒn thá»‹ FlatList vá»›i card dá»‹ch vá»¥
3. Má»—i card cÃ³ Switch báº­t/táº¯t

### Toggle Status
1. Nháº¥n Switch
2. Gá»i `handleToggleService(id, currentStatus)`
3. Toggle `enable â†” disable`
4. Update Firestore `services/{id}`

### Export Excel
1. Nháº¥n nÃºt Export (cloud-download)
2. Map services array thÃ nh format Excel Ä‘Æ¡n giáº£n
3. Táº¡o Excel file: `DB_Services_{timestamp}.xlsx`
4. **Web:** Auto download
5. **Mobile:** Share file

### Import Excel
1. Nháº¥n nÃºt Import (cloud-upload)
2. Chá»n file Excel
3. Parse file thÃ nh JSON
4. Batch write vÃ o Firestore
5. Alert thÃ nh cÃ´ng

## ğŸ”§ CÃC FUNCTION QUAN TRá»ŒNG

### `handleToggleService(id, currentStatus)`
```js
const newStatus = currentStatus === 'enable' ? 'disable' : 'enable';
await updateDoc(doc(db, 'services', id.toString()), { status: newStatus });
```

### `handleExportExcel()`
```js
const dataToExport = services.map(item => ({
  id: item.id,
  name: item.name,
  priceNormal: item.priceNormal,
  pricePromo: item.pricePromo,
  moneyShare: item.moneyShare,   // % chia sáº» cho Admin
  image: item.image,
  status: item.status,
  index: item.index,
  shopId: item.shopId,
  note: item.note
}));

const ws = XLSX.utils.json_to_sheet(dataToExport);
const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, "ServicesData");
const fileName = `DB_Services_${Date.now()}.xlsx`;
```

### `handleImportExcel()`
```js
const payload = {
  id: isNaN(Number(docId)) ? docId : Number(docId),
  name: row["name"] || "Dá»‹ch vá»¥ má»›i",
  priceNormal: Number(row["priceNormal"]) || 0,
  pricePromo: Number(row["pricePromo"]) || 0,
  moneyShare: Number(row["moneyShare"]) || 0,
  image: row["image"] || "",
  status: row["status"] || "enable",
  index: Number(row["index"]) || 0,
  shopId: Number(row["shopId"]) || 0,
  note: row["note"] || "",
  log: []
};
batch.set(docRef, payload, { merge: true });
```

## ğŸ¨ UI Cáº¤U TRÃšC

```
SafeAreaView
  â”œâ”€ Header
  â”‚   â”œâ”€ Back Button
  â”‚   â”œâ”€ Title: "Quáº£n lÃ½ Dá»‹ch vá»¥"
  â”‚   â””â”€ Button Group
  â”‚       â”œâ”€ Import Button (#2980B9)
  â”‚       â”œâ”€ Export Button (#27AE60)
  â”‚       â””â”€ Add Button (primary)
  â”‚
  â””â”€ FlatList (Service Cards)
      â””â”€ renderServiceItem: Card
          â”œâ”€ Image (60x60)
          â”œâ”€ Info
          â”‚   â”œâ”€ Row: Name + Switch
          â”‚   â”œâ”€ Price: "GiÃ¡ bÃ¡n: XK oldPrice"
          â”‚   â””â”€ Row: "Admin: X%" + ID
          â”‚
          â””â”€ onPress: Navigate to /admin/edit-service
```

## âš¡ ÄIá»‚M Äáº¶C BIá»†T

1. **ÄÆ¡n giáº£n hÆ¡n Products:** KhÃ´ng cÃ³ option, image array (chá»‰ 1 áº£nh)
2. **moneyShare Field:** % tiá»n admin nháº­n tá»« dá»‹ch vá»¥ (VD: 20%)
3. **log Array:** Reset vá» `[]` khi import (hoáº·c giá»¯ nguyÃªn tÃ¹y logic)
4. **No Search:** KhÃ´ng cÃ³ search bar (Ã­t dá»‹ch vá»¥ hÆ¡n food)
5. **Empty State:** "KhÃ´ng tÃ¬m tháº¥y dá»‹ch vá»¥ nÃ o."
6. **ActivityIndicator:** Hiá»‡n spinner khi processing
7. **Merge Mode:** `{merge: true}` Ä‘á»ƒ khÃ´ng ghi Ä‘Ã¨
8. **Switch Color:** trackColor false=#D1D1D1, true=primary+50
9. **Card Style:** elevation: 3, borderRadius: 15
10. **Price Display:** `{pricePromo}K` vá»›i `{priceNormal}K` strikethrough

## ğŸš€ USER JOURNEY

**Admin:**
1. VÃ o Admin Services tá»« dashboard (hoáº·c tÆ°Æ¡ng tá»±)
2. Xem danh sÃ¡ch dá»‹ch vá»¥
3. **Export:** Nháº¥n Export â†’ Download Excel
4. **Edit Excel:** Sá»­a giÃ¡, moneyShare, thÃªm dá»‹ch vá»¥ má»›i
5. **Import:** Nháº¥n Import â†’ Chá»n file â†’ Import
6. **Toggle:** Báº­t/táº¯t dá»‹ch vá»¥
7. **Edit:** Nháº¥n card â†’ Edit-service page

## ğŸ”— NAVIGATION

**Navigates TO:**
- `/admin/edit-service` (nháº¥n card hoáº·c nÃºt Add)

**Navigates FROM:**
- Admin dashboard (hoáº·c menu quáº£n lÃ½)

## ğŸ’¡ LÆ¯U Ã Ká»¸ THUáº¬T

1. **Excel Headers:** Match chÃ­nh xÃ¡c vá»›i Firestore field names
2. **moneyShare:** Number (0-100), Ä‘Æ¡n vá»‹ %
3. **image:** Single URL string (khÃ´ng pháº£i array nhÆ° food)
4. **status:** 'enable' | 'disable'
5. **ID Type:** CÃ³ thá»ƒ lÃ  Number hoáº·c String, check `isNaN(Number(docId))`
6. **log Field:** Array rá»—ng khi import má»›i
7. **Fallback Values:**
   - name: "Dá»‹ch vá»¥ má»›i"
   - status: "enable"
   - index: 0
   - shopId: 0
8. **No Time Fields:** Dá»‹ch vá»¥ khÃ´ng cÃ³ timeStart/timeEnd
9. **Card Height:** Auto height, khÃ´ng fixed
10. **No Status Label:** Chá»‰ dá»±a vÃ o Switch vÃ  opacity
11. **Disabled Card:** opacity: 0.6 khi status=disable
12. **Platform Support:** Web + Mobile (iOS/Android)
13. **File Picker:** DocumentPicker vá»›i type xlsx
14. **Share API:** Sharing.isAvailableAsync() trÆ°á»›c khi share
15. **Error Handling:** Try-catch vá»›i Alert feedback

## ğŸ” SO SÃNH Vá»šI PRODUCTS

**Giá»‘ng:**
- CÃ¹ng pattern Import/Export
- CÃ¹ng UI layout: Header + List + Card
- CÃ¹ng Toggle switch

**KhÃ¡c:**
- Services: ÄÆ¡n giáº£n hÆ¡n (no option, no image array)
- Services: CÃ³ moneyShare field
- Services: KhÃ´ng cÃ³ search
- Services: KhÃ´ng cÃ³ timeStart/timeEnd
- Services: Ãt record hÆ¡n â†’ KhÃ´ng cáº§n pagination
