# T√ìM T·∫ÆT LOGIC TRANG ADMIN/ORDERS.TSX

## üéØ M·ª§C ƒê√çCH
Gi√°m s√°t v√† qu·∫£n l√Ω t·∫•t c·∫£ ƒë∆°n h√†ng (food + service):
- Hi·ªÉn th·ªã ƒë∆°n h√†ng food v√† service trong 1 danh s√°ch
- Filter theo tr·∫°ng th√°i: Ch·ªù nh·∫≠n, ƒêang giao, Th√†nh c√¥ng, ƒê√£ h·ªßy
- Normalize status (x·ª≠ l√Ω typo "pendding" ‚Üí "pending")
- ƒê·∫øm s·ªë ƒë∆°n pending (hi·ªÉn th·ªã badge)
- Navigate ƒë·∫øn order-detail ho·∫∑c service-order-detail

## üìä STATE & DATA

**Store:**
- `foodOrders`: ƒê∆°n h√†ng ƒë·ªì ƒÉn
- `serviceOrders`: ƒê∆°n h√†ng d·ªãch v·ª•

**Local State:**
- `filterStatus`: 'pending' | 'processing' | 'completed' | 'cancelled'

**Status Mapping:**
- `pending` / `pendding` ‚Üí "Ch·ªù nh·∫≠n" (m√†u #E67E22 cam)
- `processing` ‚Üí "ƒêang giao" (m√†u #3498DB xanh d∆∞∆°ng)
- `completed` ‚Üí "Th√†nh c√¥ng" (m√†u #27AE60 xanh l√°)
- `cancelled` ‚Üí "ƒê√£ h·ªßy" (m√†u #E74C3C ƒë·ªè)

## üîÑ LU·ªíNG TH·ª∞C THI

### Display Flow
1. Merge `foodOrders` + `serviceOrders` th√†nh `allOrders`
2. M·ªói order th√™m field `orderType`: 'food' | 'service'
3. Normalize status c·ªßa t·∫•t c·∫£ orders:
   ```js
   const normalizeStatus = (status) => {
     const s = String(status).toLowerCase().trim();
     return s === 'pendding' ? 'pending' : s;
   }
   ```
4. Filter theo `filterStatus`
5. Sort theo `createdAt` descending
6. Render FlatList

### Tab Filter
1. 4 tabs: Ch·ªù nh·∫≠n, ƒêang giao, Th√†nh c√¥ng, ƒê√£ h·ªßy
2. Nh·∫•n tab ‚Üí `setFilterStatus(statusId)`
3. Tab "Ch·ªù nh·∫≠n" hi·ªÉn th·ªã s·ªë l∆∞·ª£ng: `(X)`

### Navigate Detail
1. Nh·∫•n order card
2. Check `orderType`:
   - `service` ‚Üí `/admin/service-order-detail`
   - `food` ‚Üí `/admin/order-detail`
3. Pass `orderId` params

## üîß C√ÅC FUNCTION QUAN TR·ªåNG

### `normalizeStatus(status)`
Chu·∫©n h√≥a status (fix typo):
```js
const normalizeStatus = (status: any) => {
  if (!status) return 'pending';
  const s = String(status).toLowerCase().trim();
  return s === 'pendding' ? 'pending' : s;
};
```

### `getPendingCount()`
ƒê·∫øm s·ªë ƒë∆°n pending (c·∫£ food + service):
```js
const getPendingCount = () => {
  let count = 0;
  
  foodOrders.forEach(order => {
    if (normalizeStatus(order.status) === 'pending') count++;
  });
  
  serviceOrders.forEach(order => {
    if (normalizeStatus(order.status) === 'pending') count++;
  });
  
  return count;
};
```

### `getStatusColor(status)`
```js
switch (status) {
  case 'pending': return '#E67E22';
  case 'processing': return '#3498DB';
  case 'completed': return '#27AE60';
  case 'cancelled': return '#E74C3C';
  default: return '#7F8C8D';
}
```

### Logic merge orders
```js
const allOrders = useMemo(() => {
  const food = foodOrders.map(order => ({ ...order, orderType: 'food' }));
  const service = serviceOrders.map(order => ({ ...order, orderType: 'service' }));
  return [...food, ...service];
}, [foodOrders, serviceOrders]);
```

## üé® UI C·∫§U TR√öC

```
SafeAreaView
  ‚îú‚îÄ Header
  ‚îÇ   ‚îú‚îÄ Back Button
  ‚îÇ   ‚îú‚îÄ Title: "Gi√°m s√°t ƒë∆°n h√†ng"
  ‚îÇ   ‚îî‚îÄ Spacer (width: 28)
  ‚îÇ
  ‚îú‚îÄ Tab Bar (Scrollable)
  ‚îÇ   ‚îú‚îÄ Tab: "Ch·ªù nh·∫≠n (X)" (active border primary)
  ‚îÇ   ‚îú‚îÄ Tab: "ƒêang giao"
  ‚îÇ   ‚îú‚îÄ Tab: "Th√†nh c√¥ng"
  ‚îÇ   ‚îî‚îÄ Tab: "ƒê√£ h·ªßy"
  ‚îÇ
  ‚îî‚îÄ FlatList (Orders)
      ‚îî‚îÄ renderOrderItem: Card
          ‚îú‚îÄ Header: #{orderId} + Status Badge
          ‚îú‚îÄ Customer: userName + userPhone
          ‚îú‚îÄ Address (icon location)
          ‚îî‚îÄ Footer: Time + Total Price
```

## ‚ö° ƒêI·ªÇM ƒê·∫∂C BI·ªÜT

1. **Unified List:** Merge food + service orders th√†nh 1 list
2. **Status Normalize:** Fix typo "pendding" th√†nh "pending" t·ª± ƒë·ªông
3. **Pending Count:** Ch·ªâ hi·ªÉn th·ªã s·ªë ·ªü tab "Ch·ªù nh·∫≠n"
4. **orderType Field:** Th√™m v√†o ƒë·ªÉ ph√¢n bi·ªát khi navigate
5. **Navigate Logic:**
   ```js
   if (item.orderType === 'service') {
     router.push({ pathname: '/admin/service-order-detail', params: { orderId } });
   } else {
     router.push({ pathname: '/admin/order-detail', params: { orderId } });
   }
   ```
6. **Time Display:** ∆Øu ti√™n `timeCreate`, fallback `createdAt.toLocaleTimeString()`
7. **Total Price:** ∆Øu ti√™n `finalTotal`, fallback `value?.total`
8. **Empty State:** Icon receipt + "Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o"
9. **Tab Scroll:** Horizontal scroll n·∫øu nhi·ªÅu tabs
10. **Active Tab:** Border bottom primary color
11. **Status Badge:** Background m√†u theo status, text tr·∫Øng
12. **Card Elevation:** 3 (Android shadow)
13. **Address Truncate:** `numberOfLines={1}`
14. **orderId Display:** `#{String(orderId || id)}`
15. **Lowercase Comparison:** Lu√¥n lowercase status tr∆∞·ªõc khi so s√°nh

## üöÄ USER JOURNEY

**Admin:**
1. V√†o Admin Orders t·ª´ dashboard
2. M·∫∑c ƒë·ªãnh tab "Ch·ªù nh·∫≠n" (pending)
3. Xem s·ªë l∆∞·ª£ng ƒë∆°n ch·ªù x·ª≠ l√Ω
4. Chuy·ªÉn tab ƒë·ªÉ xem c√°c tr·∫°ng th√°i kh√°c
5. Nh·∫•n card ƒë·ªÉ xem chi ti·∫øt:
   - Food order ‚Üí order-detail page
   - Service order ‚Üí service-order-detail page
6. Quay l·∫°i dashboard

## üîó NAVIGATION

**Navigates TO:**
- `/admin/order-detail` (food orders)
- `/admin/service-order-detail` (service orders)

**Navigates FROM:**
- Admin dashboard menu "Qu·∫£n l√Ω ƒê∆°n h√†ng"

## üí° L∆ØU √ù K·ª∏ THU·∫¨T

1. **Status Typo:** "pendding" l√† typo ph·ªï bi·∫øn trong DB, c·∫ßn normalize
2. **useMemo Dependencies:** `[foodOrders, serviceOrders]` ƒë·ªÉ tr√°nh re-render
3. **Filter Logic:**
   ```js
   .filter(order => normalizeStatus(order.status) === filterStatus)
   ```
4. **Sort Logic:**
   ```js
   .sort((a, b) => new Date(b.createdAt || b.timeCreate || 0) - new Date(a.createdAt || a.timeCreate || 0))
   ```
5. **Time Fields:** `createdAt` (ISO) ho·∫∑c `timeCreate` (string formatted)
6. **Total Fields:** `finalTotal` (food) ho·∫∑c `value.total` (service)
7. **keyExtractor:** `String(item.orderId || item.id)` ƒë·ªÉ ensure string
8. **Tab Label Format:** Only pending tab has count badge
9. **Status List Config:**
   ```js
   const statusList = [
     { id: 'pending', label: 'Ch·ªù nh·∫≠n' },
     { id: 'processing', label: 'ƒêang giao' },
     { id: 'completed', label: 'Th√†nh c√¥ng' },
     { id: 'cancelled', label: 'ƒê√£ h·ªßy' }
   ];
   ```
10. **Empty userName:** Fallback "Kh√°ch h√†ng" n·∫øu thi·∫øu
11. **Empty address:** Fallback "Ch∆∞a c√≥ ƒë·ªãa ch·ªâ"
12. **Badge Style:** paddingHorizontal 8, paddingVertical 3, fontSize 10
13. **Tab Height:** 55px fixed
14. **contentContainerStyle:** padding 15, paddingBottom 50
15. **Header Spacing:** justifyContent space-between v·ªõi spacer width 28

## üîç SO S√ÅNH V·ªöI USER ORDERS PAGE

**Gi·ªëng:**
- C√πng hi·ªÉn th·ªã order list
- C√πng c√≥ status filter
- C√πng navigate detail

**Kh√°c:**
- Admin: Xem T·∫§T C·∫¢ ƒë∆°n (food + service)
- Admin: Kh√¥ng c√≥ n√∫t H·ªßy
- Admin: Navigate c·∫£ food + service detail
- Admin: C√≥ s·ªë l∆∞·ª£ng pending badge
- User: Ch·ªâ xem ƒë∆°n c·ªßa m√¨nh
- User: C√≥ n√∫t H·ªßy ƒë∆°n pending
- User: Ch·ªâ xem food orders
- User: Hi·ªÉn th·ªã log h√†nh tr√¨nh
