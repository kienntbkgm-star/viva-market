# TÃ“M Táº®T LOGIC TRANG APP/LOGIN.TSX

## ğŸ¯ Má»¤C ÄÃCH
MÃ n hÃ¬nh Ä‘Äƒng nháº­p cá»§a app:
- ÄÄƒng nháº­p báº±ng sá»‘ Ä‘iá»‡n thoáº¡i + máº­t kháº©u
- Quick login buttons cho testing (4 roles)
- Guest access option
- Auto redirect náº¿u Ä‘Ã£ Ä‘Äƒng nháº­p

## ğŸ“Š STATE & DATA

**App Store:**
```js
const { 
  currentUser,           // User Ä‘ang Ä‘Äƒng nháº­p (null if not logged in)
  login,                 // Function login(phone, password)
  initializeGuest        // Function for guest mode
} = useAppStore();
```

**Local State:**
```js
phone: string             // Sá»‘ Ä‘iá»‡n thoáº¡i (input)
password: string          // Máº­t kháº©u (input)
```

**Quick Login Credentials:**
```js
ADMIN: {
  phone: '0931837176',
  password: 'Kien1234',
  userId: 205,
  role: 'admin'
}

SHIPPER: {
  phone: '0988276552',
  password: 'Kien1234',
  userId: 212,
  role: 'shipper'
}

SHOP_OWNER: {
  phone: '0979934882',
  password: 'Kien1234',
  userId: 208,
  role: 'user' (shop owner)
}

USER: {
  phone: '0931837170',
  password: 'Kien1234',
  userId: 213,
  role: 'user'
}
```

## ğŸ”„ LUá»’NG THá»°C THI

### 1. Auto Redirect if Logged In
```js
if (currentUser) {
  return <Redirect href="/(tabs)/home" />;
}

/**
 * WHY?
 * - User already logged in
 * - No need to show login screen
 * - Redirect to home page
 */
```

### 2. Normal Login
```js
const handleLogin = async () => {
  // 1. Validate phone
  if (!phone || phone.trim().length < 10) {
    Alert.alert("Lá»—i", "Vui lÃ²ng nháº­p sá»‘ Ä‘iá»‡n thoáº¡i há»£p lá»‡ (Ã­t nháº¥t 10 sá»‘)");
    return;
  }
  
  // 2. Validate password
  if (!password || password.trim().length === 0) {
    Alert.alert("Lá»—i", "Vui lÃ²ng nháº­p máº­t kháº©u");
    return;
  }
  
  // 3. Call login from store
  try {
    await login(phone.trim(), password.trim());
    
    // 4. Login success â†’ Auto navigate to home (via Redirect component)
    router.replace('/(tabs)/home');
    
  } catch (error) {
    // 5. Login failed â†’ Show error
    Alert.alert(
      "ÄÄƒng nháº­p tháº¥t báº¡i", 
      error.message || "Sá»‘ Ä‘iá»‡n thoáº¡i hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng"
    );
  }
};
```

### 3. Quick Login (Testing)
```js
const quickLogin = async (role) => {
  // Map role to credentials
  const credentials = {
    admin: { phone: '0931837176', password: 'Kien1234' },
    shipper: { phone: '0988276552', password: 'Kien1234' },
    shopOwner: { phone: '0979934882', password: 'Kien1234' },
    user: { phone: '0931837170', password: 'Kien1234' }
  };
  
  const cred = credentials[role];
  
  try {
    // Auto fill & login
    await login(cred.phone, cred.password);
    router.replace('/(tabs)/home');
  } catch (error) {
    Alert.alert("Lá»—i", "Quick login tháº¥t báº¡i");
  }
};
```

### 4. Guest Access
```js
const handleGuestAccess = async () => {
  try {
    // Initialize guest user (no phone, no password)
    await initializeGuest();
    
    // Navigate to home
    router.replace('/(tabs)/home');
    
  } catch (error) {
    Alert.alert("Lá»—i", "KhÃ´ng thá»ƒ vÃ o cháº¿ Ä‘á»™ khÃ¡ch");
  }
}
- USER: 0931837170
  â†“
handleLogin(phone_cá»§a_nÃºt, 'Kien1234')
  â†“
Tá»± Ä‘á»™ng Ä‘Äƒng nháº­p vá»›i thÃ´ng tin sáºµn
```

### 4ï¸âƒ£ **Guest Access (Bá» qua Ä‘Äƒng nháº­p)**
```
Nháº¥n "Bá» qua Ä‘Äƒng nháº­p"
  â†“
handleGuestAccess() Ä‘Æ°á»£c gá»i
  â†“
initializeGuest() - Táº¡o guest user:
  â€¢ ID = timestamp
  â€¢ name, phone, address, password = ""
  â€¢ LÆ°u vÃ o Firestore
  â€¢ LÆ°u ID vÃ o AsyncStorage
  â†“
router.replace('/(tabs)/home')
```

## ğŸ”§ CÃC FUNCTION QUAN TRá»ŒNG

### `handleLogin(customPhone?, customPass?)`
**Má»¥c Ä‘Ã­ch:** Xá»­ lÃ½ Ä‘Äƒng nháº­p (thá»§ cÃ´ng hoáº·c quick login)

**Logic:**
```
1. Láº¥y phone/pass tá»« params HOáº¶C tá»« state
2. Validate: phone.length >= 10
3. Gá»i login() tá»« store
4. Náº¿u success:
   - router.replace('/(tabs)/home')
5. Náº¿u fail:
   - Alert.alert("Lá»—i", result.message)
```

**Äáº·c Ä‘iá»ƒm:**
- CÃ³ thá»ƒ nháº­n params (cho quick login)
- Hoáº·c dÃ¹ng state (cho manual login)
- Flexible Ä‘á»ƒ phá»¥c vá»¥ cáº£ 2 trÆ°á»ng há»£p

### `handleGuestAccess()`
**Má»¥c Ä‘Ã­ch:** Táº¡o guest user vÃ  vÃ o app

**Logic:**
```
1. await initializeGuest()
   - Táº¡o user vá»›i password = ""
   - LÆ°u vÃ o Firestore + AsyncStorage
2. router.replace('/(tabs)/home')
```

**Äáº·c Ä‘iá»ƒm:**
- KhÃ´ng cáº§n nháº­p thÃ´ng tin gÃ¬
- Táº¡o user táº¡m vá»›i ID = timestamp
- VÃ o app ngay láº­p tá»©c

## ğŸ¨ UI Cáº¤U TRÃšC

```
SafeAreaView
  â†“
ScrollView
  â”œâ”€â”€ Image (onboardImage.png)
  â”œâ”€â”€ Title: "VIVA MARKET"
  â”œâ”€â”€ MyInput (Sá»‘ Ä‘iá»‡n thoáº¡i)
  â”œâ”€â”€ MyInput (Máº­t kháº©u - isPass)
  â”œâ”€â”€ MyButton (ÄÄ‚NG NHáº¬P)
  â”œâ”€â”€ Quick Login Container
  â”‚   â”œâ”€â”€ Title: "ÄÄƒng nháº­p nhanh cho Tester"
  â”‚   â””â”€â”€ 4 nÃºt (2x2 grid - width 48%):
  â”‚       â”œâ”€â”€ ADMIN (Ä‘á»)
  â”‚       â”œâ”€â”€ SHIPPER (xanh lÃ¡)
  â”‚       â”œâ”€â”€ CHá»¦ SHOP (vÃ ng)
  â”‚       â””â”€â”€ USER (xanh dÆ°Æ¡ng)
  â””â”€â”€ Link Container
      â”œâ”€â”€ "ChÆ°a cÃ³ tÃ i khoáº£n? ÄÄƒng kÃ½ ngay" â†’ /register
      â””â”€â”€ "Hoáº·c Bá» qua Ä‘Äƒng nháº­p" â†’ handleGuestAccess()
```

## ğŸ” Dá»® LIá»†U QUICK LOGIN

**Máº£ng quickLogins (hard-coded):**
```javascript
[
  { label: 'ADMIN', phone: '0931837176', pass: 'Kien1234', color: '#E74C3C' },
  { label: 'SHIPPER', phone: '0988276552', pass: 'Kien1234', color: '#27AE60' },
  { label: 'CHá»¦ SHOP', phone: '0979934882', pass: 'Kien1234', color: '#F1C40F' },
  { label: 'USER', phone: '0931837170', pass: 'Kien1234', color: '#3498DB' }
]
```

**Má»¥c Ä‘Ã­ch:**
- Cho developer/tester Ä‘Äƒng nháº­p nhanh
- KhÃ´ng cáº§n nhá»›/nháº­p thÃ´ng tin
- Test nhanh cÃ¡c role khÃ¡c nhau

## âš™ï¸ VALIDATION

### Validate sá»‘ Ä‘iá»‡n thoáº¡i:
```javascript
if (finalPhone.length < 10) {
  return Alert.alert("Lá»—i", "Sá»‘ Ä‘iá»‡n thoáº¡i khÃ´ng há»£p lá»‡");
}
```

**LÆ°u Ã½:**
- Chá»‰ check Ä‘á»™ dÃ i >= 10
- KhÃ´ng check format chi tiáº¿t (regex)
- ÄÆ¡n giáº£n Ä‘á»ƒ dá»… test

## âš¡ ÄIá»‚M Äáº¶C BIá»†T

âœ… **Auto redirect náº¿u Ä‘Ã£ login** - KhÃ´ng cho vÃ o trang login náº¿u Ä‘Ã£ cÃ³ currentUser
âœ… **State máº·c Ä‘á»‹nh cÃ³ sáºµn** - Phone & password Ä‘Ã£ Ä‘iá»n sáºµn Ä‘á»ƒ test nhanh
âœ… **3 cÃ¡ch Ä‘Äƒng nháº­p** - Manual, Quick login, Guest access
âœ… **Quick login grid 2x2** - Má»—i nÃºt width 48%, mÃ u khÃ¡c nhau theo role
âœ… **KhÃ´ng loading state** - Login xong thÃ¬ redirect ngay, khÃ´ng cáº§n spinner
âœ… **expoToken tá»± Ä‘á»™ng gá»­i** - Cho push notification (náº¿u cÃ³)

## ğŸš€ USER JOURNEY

### **User thÆ°á»ng:**
```
Má»Ÿ app â†’ Index â†’ Click "CONTINUE TO APP"
  â†“
KhÃ´ng cÃ³ session â†’ Login
  â†“
Nháº­p SÄT + password â†’ Nháº¥n "ÄÄ‚NG NHáº¬P"
  â†“
Success â†’ Home
```

### **Tester:**
```
VÃ o Login
  â†“
Click 1 trong 4 nÃºt quick login
  â†“
Tá»± Ä‘á»™ng Ä‘Äƒng nháº­p â†’ Home
```

### **Guest:**
```
VÃ o Login
  â†“
Click "Bá» qua Ä‘Äƒng nháº­p"
  â†“
Táº¡o guest user â†’ Home
```

### **User Ä‘Ã£ login trÆ°á»›c:**
```
Má»Ÿ app â†’ Index â†’ Click "CONTINUE TO APP"
  â†“
CÃ³ session â†’ Home (skip Login)
```

## ğŸ”— NAVIGATION

**Tá»« Login Ä‘i Ä‘áº¿n:**
- âœ… Home: Sau khi login thÃ nh cÃ´ng hoáº·c guest access
- âœ… Register: Click link "ÄÄƒng kÃ½ ngay"

**VÃ o Login tá»«:**
- âœ… Index: Náº¿u khÃ´ng cÃ³ session (click "CONTINUE TO APP")
- âœ… Profile: Náº¿u guest click "ÄÄ‚NG NHáº¬P NGAY"

## ğŸ’¡ LÆ¯U Ã Ká»¸ THUáº¬T

**Default values cho testing:**
- Phone máº·c Ä‘á»‹nh: '0931837170' (USER)
- Password máº·c Ä‘á»‹nh: 'Kien1234'
- GiÃºp test nhanh khÃ´ng cáº§n nháº­p

**Quick login flexible:**
- handleLogin() nháº­n optional params
- Náº¿u khÃ´ng cÃ³ params â†’ dÃ¹ng state
- Náº¿u cÃ³ params â†’ dÃ¹ng params
- Má»™t function phá»¥c vá»¥ cáº£ manual & quick login

**Guest user structure:**
```javascript
{
  id: Date.now(),          // timestamp
  name: "",                // rá»—ng
  phone: "",               // rá»—ng
  address: "",             // rá»—ng
  password: "",            // rá»—ng - dÃ¹ng Ä‘á»ƒ check isGuest
  role: "user",
  status: "enable",
  point: 0
}
```

===============================================================================
Cáº¬P NHáº¬T: 27/01/2026
===============================================================================
